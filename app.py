import streamlit as st 
import google.generativeai as genai

# ============= ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ =============
st.set_page_config(
    page_title="ูุณุงุนุฏ ุงููุงููู ุงููุตุฑู", 
    page_icon="โ๏ธ"
)

# ============= ุงูุฏูุงู ุงูุฃุณุงุณูุฉ =============

def get_ai_response(user_question):
    """ุงูุญุตูู ุนูู ุฅุฌุงุจุฉ ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุน ุงูุชุนูููุงุช ุงููุงููููุฉ"""
    try:
        # ุฅุนุฏุงุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
        GOOGLE_API_KEY = "----"
        genai.configure(api_key=GOOGLE_API_KEY)
        model = genai.GenerativeModel('gemini-2.5-flash')
        
        # ุฅูุดุงุก ุงูุชุนูููุงุช ูุน ุงูุณุคุงู
        instructions = """ุฃูุช ูุณุงุนุฏ ูุงูููู ูุชุฎุตุต ูู ุงููุงููู ุงููุตุฑู.
        
        ููุงุนุฏ ูููุฉ:
        - ุฃุฌุจ ุฏุงุฆูุงู ุจุงููุบุฉ ุงูุนุฑุจูุฉ
        - ูุฏู ูุนูููุงุช ุฏูููุฉ ุนู ุงููุงููู ุงููุตุฑู
        - ุงุฐูุฑ ุฃุฑูุงู ุงูููุงุฏ ุงููุงููููุฉ ุนูุฏูุง ูููู ุฐูู ููููุงู
        - ูุจู ุงููุณุชุฎุฏู ุฃู ูุฐู ูุนูููุงุช ุนุงูุฉ ูููุณุช ุงุณุชุดุงุฑุฉ ูุงููููุฉ ุฑุณููุฉ
        - ุฅุฐุง ูู ุชูู ูุชุฃูุฏุงูุ ุฃุฎุจุฑ ุงููุณุชุฎุฏู ุจุฐูู
        
        ุณุคุงู ุงููุณุชุฎุฏู: """
        
        full_prompt = instructions + user_question
        
        # ุงูุญุตูู ุนูู ุงูุฅุฌุงุจุฉ
        response = model.generate_content(full_prompt)
        return response.text
        
    except Exception as error:
        return f"ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ: {str(error)}"


def show_chat_history():
    """ุนุฑุถ ุณุฌู ุงููุญุงุฏุซุฉ"""
    for message in st.session_state.chat_history:
        with st.chat_message(message["role"]):
            st.markdown(message["content"])


# ============= ูุงุฌูุฉ ุงูุจุฑูุงูุฌ =============

# ุชููุฆุฉ ุงูุฌูุณุฉ
if 'chat_history' not in st.session_state:
    st.session_state.chat_history = []

# ุงูุนููุงู ูุงููุตู
st.title("โ๏ธ ูุณุงุนุฏ ุงููุงููู ุงููุตุฑู")
st.info("๐ก ูุฐุง ุงููุณุงุนุฏ ููุฏู ูุนูููุงุช ุนุงูุฉ ุนู ุงููุงููู ุงููุตุฑู ูููุณ ุจุฏููุงู ุนู ุงูุงุณุชุดุงุฑุฉ ุงููุงููููุฉ ุงููุชุฎุตุตุฉ")

# ุงูุดุฑูุท ุงูุฌุงูุจู
with st.sidebar:
    st.markdown("### ๐ ูุนูููุงุช")
    st.markdown("""
    ูุฐุง ุงููุณุงุนุฏ ููููู ูุณุงุนุฏุชู ูู:
    - ููู ุงูููุงููู ุงููุตุฑูุฉ
    - ูุนุฑูุฉ ุญูููู ููุงุฌุจุงุชู
    - ุงูุฅุฌุฑุงุกุงุช ุงููุงููููุฉ
    - ุงูุฃุณุฆูุฉ ุงููุงููููุฉ ุงูุนุงูุฉ
    """)
    
    st.markdown("---")
    
    if st.button("๐๏ธ ูุณุญ ุงููุญุงุฏุซุฉ"):
        st.session_state.chat_history = []
        st.rerun()



# ุนุฑุถ ุงูููุงุถูุน ุงูููุชุฑุญุฉ (ููุท ูู ุงูุจุฏุงูุฉ)
selected_topic = None
if len(st.session_state.chat_history) == 0:
    st.write("**ุงุฎุชุฑ ููุถูุนุงู ุฃู ุงูุชุจ ุณุคุงูู:**")
    selected_topic = st.pills(
        "ููุงุถูุน ุดุงุฆุนุฉ:",
        [
            "ูุงููู ุงูุนูู", 
            "ูุงููู ุงูุฃุญูุงู ุงูุดุฎุตูุฉ", 
            "ุงููุงููู ุงููุฏูู", 
            "ุงููุงููู ุงูุฌูุงุฆู", 
            "ูุงููู ุงูุฅูุฌุงุฑุงุช", 
            "ูุงููู ุงูุชุฌุงุฑุฉ"
        ],
        selection_mode="single"
    )

# ุนุฑุถ ุงููุญุงุฏุซุงุช ุงูุณุงุจูุฉ
show_chat_history()

# ุตูุฏูู ุฅุฏุฎุงู ุงูุณุคุงู
user_question = st.chat_input("ุงูุชุจ ุณุคุงูู ุงููุงูููู ููุง...")

# ูุนุงูุฌุฉ ุงุฎุชูุงุฑ ููุถูุน ูู ุงูููุชุฑุญุงุช
if selected_topic:
    user_question = f"ุฃุฎุจุฑูู ุนู {selected_topic} ูู ุงููุงููู ุงููุตุฑู"

# ูุนุงูุฌุฉ ุงูุณุคุงู
if user_question:
    # ุฅุถุงูุฉ ูุนุฑุถ ุณุคุงู ุงููุณุชุฎุฏู
    st.session_state.chat_history.append({"role": "user", "content": user_question})

    with st.chat_message("user"):
        st.markdown(user_question)
    
    # ุงูุญุตูู ุนูู ุงูุฅุฌุงุจุฉ ูุนุฑุถูุง
    with st.chat_message("assistant"):
        with st.spinner('ุฌุงุฑู ุงูุจุญุซ...'):
            ai_answer = get_ai_response(user_question)
            st.markdown(ai_answer)
    
    # ุฅุถุงูุฉ ุงูุฅุฌุงุจุฉ ููุณุฌู
    st.session_state.chat_history.append({"role": "assistant", "content": ai_answer})
    
    # ุชุญุฏูุซ ุงูุตูุญุฉ
    st.rerun()